---
title: "Peer Assessment 2 (need title that summarizes!)"
author: "Shawn"
date: "08/19/2015"
output: html_document
---

## Synopsis

_Describe and summarize the data analysis in less than 10 sentences_

## Data Processing

```{r}
# set working directory
#   change to match your computer when running this script
setwd("~/Documents/courses/repdata/RepData_PeerAssessment2")

# read in the data file
noaa <- read.csv("data/repdata_data_StormData.csv.bz2",
                 sep = ",",
                 strip.white = TRUE,
                 stringsAsFactors = FALSE)
```


```{r}
# only include columns relevent to our questions
noaa <- subset(noaa, 
               select = c(EVTYPE,FATALITIES,INJURIES,
                          PROPDMG,PROPDMGEXP,CROPDMG,CROPDMGEXP))

# upshift PROPDMGEXP and CROPDMGEXP columns
noaa$PROPDMGEXP <- toupper(noaa$PROPDMGEXP)
noaa$CROPDMGEXP <- toupper(noaa$CROPDMGEXP)

# add columns for property and crop damage totals
noaa$TOTPROPDMG <- 0
noaa$TOTCROPDMG <- 0

numbers <- as.character(1:9)

# calculate property damage totals
noaa$TOTPROPDMG[which(noaa$PROPDMGEXP %in% numbers)] <- 
  noaa$PROPDMG[which(noaa$PROPDMGEXP %in% numbers)] * 1
noaa$TOTPROPDMG[which(noaa$PROPDMGEXP == "H")] <- 
  noaa$PROPDMG[which(noaa$PROPDMGEXP == "H")] * 100
noaa$TOTPROPDMG[which(noaa$PROPDMGEXP == "K")] <- 
  noaa$PROPDMG[which(noaa$PROPDMGEXP == "K")] * 1000
noaa$TOTPROPDMG[which(noaa$PROPDMGEXP == "M")] <- 
  noaa$PROPDMG[which(noaa$PROPDMGEXP == "M")] * 1000000
noaa$TOTPROPDMG[which(noaa$PROPDMGEXP == "B")] <- 
  noaa$PROPDMG[which(noaa$PROPDMGEXP == "B")] * 1000000000

# calculate crop damage totals
noaa$TOTCROPDMG[which(noaa$CROPDMGEXP %in% numbers)] <- 
  noaa$CROPDMG[which(noaa$CROPDMGEXP %in% numbers)] * 1
noaa$TOTCROPDMG[which(noaa$CROPDMGEXP == "H")] <- 
  noaa$CROPDMG[which(noaa$CROPDMGEXP == "H")] * 100
noaa$TOTCROPDMG[which(noaa$CROPDMGEXP == "K")] <- 
  noaa$CROPDMG[which(noaa$CROPDMGEXP == "K")] * 1000
noaa$TOTCROPDMG[which(noaa$CROPDMGEXP == "M")] <-
  noaa$CROPDMG[which(noaa$CROPDMGEXP == "M")] * 1000000
noaa$TOTCROPDMG[which(noaa$CROPDMGEXP == "B")] <- 
  noaa$CROPDMG[which(noaa$CROPDMGEXP == "B")] * 1000000000
```

## Results

**Event affecting population health**

The graphs below show the top ten most harmful events with respect to population health. 

```{r}
library(ggplot2)
```

```{r}
# injuries by EVTYPE
injuries <- aggregate(INJURIES ~ EVTYPE, noaa, sum)
top10injuries <- head(injuries[with(injuries, order(-INJURIES)), ], n=10L)

ggplot(data=top10injuries, aes(x=EVTYPE, y=INJURIES)) +
  geom_bar(colour="black", fill="#DD8888", width=.8, stat="identity") +
  theme(axis.text.x = element_text(angle = 90, hjust = 1)) +
  xlab("Event Type") + 
  ylab("Number of Injuries") +
  ggtitle("Injuries by Event")
```

```{r}
# fatalities by EVTYPE
fatalities <- aggregate(FATALITIES ~ EVTYPE, noaa, sum)
top10fatalities <- head(fatalities[with(fatalities, order(-FATALITIES)), ], n=10L)

ggplot(data=top10fatalities, aes(x=EVTYPE, y=FATALITIES)) +
  geom_bar(colour="black", fill="#DD8888", width=.8, stat="identity") + 
  theme(axis.text.x = element_text(angle = 90, hjust = 1)) +
  xlab("Event Type") + 
  ylab("Number of Fatalities") +
  ggtitle("Fatalites by Event")
```

**Events affecting economic damage to property and crops**

The tables below show economic impact in billions of dollars.

```{r}
library(knitr)
```

**Property Damage**

```{r}
# property damage by EVTYPE
totpropdmg <- aggregate(TOTPROPDMG ~ EVTYPE, noaa, sum)
# convert to billions for reporting purposes; sum get too large
totpropdmg$TOTPROPDMG <- round(totpropdmg$TOTPROPDMG/1000000000, digits=1)

kable(head(totpropdmg[with(totpropdmg, order(-TOTPROPDMG)), ], n=10L),
      row.name= FALSE, col.names = c("Event Type","Cost of Damage"),
      caption = "Property Damage in Billions of Dollars")
```

**Crop Damage**

```{r}
# crop damage by EVTYPE
totcropdmg <- aggregate(TOTCROPDMG ~ EVTYPE, noaa, sum)
# convert to billions for reporting purposes; sum get too large
totcropdmg$TOTCROPDMG <- round(totcropdmg$TOTCROPDMG/1000000000, digits=1)

kable(head(totcropdmg[with(totcropdmg, order(-TOTCROPDMG)), ], n=10L),
      row.name= FALSE, col.names = c("Event Type","Cost of Damage"),
      caption = "Crop Damage in Billions of Dollars")
```
